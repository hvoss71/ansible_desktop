---
# Dieses Skript enthält die Software-Grundausstattung der PC-Räume, soweit 
# sie über Debian oder Flatpak verfügbar ist. Es erzeugt zudem einen Cronjob,
# der dieses Script alle 10 Minuten neu über Github aufruft. Nach erstmaliger
# Ausführung des Skriptes über ssh ist also keine weitere manuelle Ausführung 
# erforderlich, da Änderungen am Skript auf Github bei Nutzung der Rechner 
# automatisch nach 10 Minuten von den Clients übernommen werden. Ein Schlüssel
# ist nicht erforderlich, da das Playbook öffentlich im Netz steht. Das Instal-
# lieren, Aktualisieren oder auch Löschen von Software kann so einmalig im 
# Playbook informatik.yml vorgenommen werden und wird dann automatisch auf 
# alle Clients ausgerollt. Diese Vorgänge finden im Hintergrund statt 
# und stören die Arbeit an den Clients in der Regel nicht.

- hosts: localhost
  connection: local
  become: true

  tasks:
  - name: Installiere Pakete aus dem Debian-Repository
    package:
      name: 
        - arduino                               # Arduino 1
        - emacs                                 # Emacs
        - gedit                                 # GNOME-Editor
        - kate                                  # KDE Editor
        - veyon-configurator                    # Veyon für Schülergeräte
        - chromium                              # Chromium-Browser, benötigt für LEGO Spike web App etc.
        - shotcut                               # einfaches Videoschnitt-Programm
        - python-is-python3                     # Python  
        - python3-psutil                        # Abrufen von Informationen über laufende Prozesse
        - inkscape                              # Vektorgrafik
        - catfish                               # Datei- und Volltextsuche
        - flatpak                               # Flatpak 
        - gnome-software-plugin-flatpak         # Integration von Flatpak in GNOME
      state: latest
      update_cache: yes

  - name: Füge das Flathub Flatpak Repository zur System-Installation hinzu
    community.general.flatpak_remote:
      name: flathub
      state: present
      flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
      method: system

  - name: Installiere die Flatpak-Pakete
    community.general.flatpak:
      name:  
        - ch.tigerjython.TigerJython2            # TigerJython Programmier-Lernumgebung für Python
        - de.lernsoftware_filius.Filius          # Filius Netwerkbau
        - org.eclipse.Java                       # Eclipse Java-Editor
        - org.processing.processingide           # Processing Java-Editor 
        - com.prusa3d.PrusaSlicer                # 3D-Druck
        - com.visualstudio.code                  # Microsoft Visual Studio
        - edu.mit.Scratch                        # Scratch 3 (deb-Paket ist veraltet)
        - com.github.PintaProject.Pinta          # Pendant zu Paint in der Windows-Welt
        - cc.arduino.IDE2                        # Arduino 2
        - org.bluej.BlueJ                        # Java-Editor
        - com.jetbrains.IntelliJ-IDEA-Community  # Java und Kotlin-Editor
        - com.vscodium.codium                    # Java und Visual Studio Editor
      state: present

  - name: Ansible-pull Cronjob hinzufügen
    ansible.builtin.cron: 
      name: ansible auto-provision
      user: root
      minute: "*/10"
      job: sudo ansible-pull -o -U https://github.com/hvoss71/ansible_desktop.git informatik.yml
 
